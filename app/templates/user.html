{% extends "base.html" %}
{% import "_macros.html" as macros %}

{% block title %}Seaside - {{ user.username }}{% endblock %}

{% block main_content %}
<div class="user-profile-card card" xmlns="http://www.w3.org/1999/html">
    <div class="profile-head">
        <div class="container-fluid">
            <div class="top">
                <h4>{{user.username}}{% if user.about_me %}<span class="text-muted">, {{user.about_me}}</span>{% endif %}</h4>
            </div>
            <div class="body">
                <img class="avatar-rounded pull-left" src="{{ user.gravatar(size=100) }}">
                <div class="profile-head-info">
                    <div class="items">
                            <div class="item" id="item-location">
                                <i class="profile-icon icon-map-marker"></i>
                                <span class="edit-wrap text-muted">
                                    <span id="user-location">
                                    {% if user.location and user.location != ''%}{{ user.location }}{% endif %}
                                    </span>
                                    <a class="editable" href="javascript:;"><i class="icon-pencil"></i> 修改</a>
                                </span>
                                <span class="edit-hidden">
                                    <form class="form-inline" id="location-form">
                                        <div class="form-group">
                                            <input type="text" name="location" maxlength="32" size="15" class="form-control input-sm" placeholder="居住地">
                                        </div>
                                        <button type="button" class="btn btn-primary btn-sm" onclick="changeLocation()">确定</button>
                                    </form>
                                </span>
                            </div>
                            <div class="item" id="item-job">
                                <i class="profile-icon icon-suitcase"></i>
                            </div>
                    </div>
                    <div class="info-describe">
                        <!--TODO add use describe-->
                        <p>...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="profile-operation">
        <div class="container-fluid">
            <div class="profile-operation-text pull-left text-muted">获得 <i class="icon-heart"></i> <strong>{{ like_cnt }}</strong> 喜欢</div>
            <div class="pull-right">
            {% if user == current_user %}
                <a class="btn btn-primary btn-sm" href="{{ url_for('.edit_profile') }}">变更资料</a>
            {% endif %}
{#            {% if current_user.is_administrator() %}#}
{#                <a class="btn btn-warning btn-sm" href="{{ url_for('.edit_profile_admin', id=user.id) }}">变更资料[Admin]</a>#}
{#            {% endif %}#}
                {% if current_user.is_administrator() %}
                <a class="btn btn-warning btn-sm" role="button" href="mailto:{{ user.email }}"><i class="icon-envelope"></i></a>
            {% endif %}
                {% if current_user.can(Permission.FOLLOW) and user != current_user %}
                {% if not current_user.is_following(user) %}
                    <a class="btn btn-primary btn-sm" role="button" href="{{ url_for('.follow', username=user.username) }}">关注</a>
                {% else %}
                    <a class="btn btn-default btn-sm" role="button" href="{{ url_for('.unfollow', username=user.username) }}">取消关注</a>
                {% endif %}
            {% endif %}
            </div>
        </div>
    </div>
    <div class="profile-nav shadowed">
        <nav class="navbar navbar-default cast-away-margin cast-away-border">
            <ul class="nav navbar-nav">
                <li class="active"><a class="navbar-brand" href="{{ url_for('.user', username=user.username) }}"><i class="icon-home"></i></a></li>
                <li><a class="load-section" href="{{ url_for('.user_posts', username=user.username) }}">文章 {{ user.posts.count() }}</a></li>
                <li><a class="load-section" href="{{ url_for('.liked_posts', username=user.username) }}">喜欢 {{ user.liked.count() }}</a></li>
            </ul>
        </nav>
    </div>
</div>

<div class="user-profile-section-wrap">{{ macros.posts_card(posts) }}</div>

{% endblock %}

{% block sidebar_content %}
    <div class="profile-sidebar-item text-muted" id="user-follows">
        <div class="following-item">
            <a class="load-section text-muted" href="{{ url_for('.followers', username=user.username) }}"><span>关注者</br><strong>{{ user.followers.count() - 1 }}</strong>人</span></a>
        </div>
        <div class="following-item">
            <a class="load-section text-muted" href="{{ url_for('.followed_by', username=user.username) }}"><span>关注了</br><strong>{{ user.followed.count() - 1 }}</strong>人</span></a>
        </div>
        <div class="clearfix"></div>
    </div>
    <div class="profile-sidebar-item text-muted" id="ping-time">
        <p>上次登陆 <strong>{{ moment(user.last_seen).fromNow() }}</strong></p>
        <p>加入时间 <strong>{{ moment(user.member_since).format('L') }}</strong></p>
    </div>
{% endblock %}

{% block scripts %}
    {{ super() }}
    <script src="../static/scripts/edit.userprofile.js"></script>
    <script src="../static/scripts/user_profile_operations/profile.load.js"></script>
{% endblock %}
