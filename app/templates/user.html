{% extends "base.html" %}
{% import "_macros.html" as macros %}

{% block title %}Seaside - {{ user.username }}{% endblock %}

{% block page_content %}
<div class="user-profile-card card" xmlns="http://www.w3.org/1999/html">
    <div class="profile-head">
        <div class="container-fluid">
            <div class="top">
                <h4>{{user.username}}{% if user.about_me %}<span class="text-muted">, {{user.about_me}}</span>{% endif %}</h4>
            </div>
            <div class="body">
                <img class="img-rounded pull-left" src="{{ user.gravatar(size=100) }}">
                <div class="profile-head-info">
                    <div class="info-items">
                        <ul class="list-unstyled">
                            <li>
                                <span><i class="icon-map-marker"></i>
                                    {% if user.location %}
                                    <a href="http://maps.google.com/?q={{ user.location }}">{{ user.location }}</a>
                                    {% else %}
                                    <a href="#">填写地址信息</a>
                                    {% endif %}
                                </span>
                            </li>
                            <li><span><i class="icon-suitcase"></i> 职业</span></li>
                        </ul>
                    </div>
                    <div class="info-describe">
                        <!--TODO add use describe-->
                        <p>...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="profile-operation">
        <div class="container-fluid">
            <span>获得 <i class="icon-heart"></i>{{ like_cnt }}喜欢</span>
            <div class="pull-right">
            {% if user == current_user %}
            <a class="btn btn-primary btn-sm" href="{{ url_for('.edit_profile') }}">变更资料</a>
            {% endif %}
            {% if current_user.is_administrator() %}
            <a class="btn btn-warning btn-sm" href="{{ url_for('.edit_profile_admin', id=user.id) }}">变更资料[Admin]</a>
            {% endif %}
            {% if current_user.is_administrator() %}
                <a class="btn btn-warning btn-sm" role="button" href="mailto:{{ user.email }}"><i class="icon-envelope"></i></a>
            {% endif %}
            {% if current_user.can(Permission.FOLLOW) and user != current_user %}
                {% if not current_user.is_following(user) %}
                <a class="btn btn-primary btn-sm" role="button" href="{{ url_for('.follow', username=user.username) }}">关注</a>
                {% else %}
                <a class="btn btn-default btn-sm" role="button" href="{{ url_for('.unfollow', username=user.username) }}">取消关注</a>
                {% endif %}
            {% endif %}
            </div>
        </div>
    </div>

    <div class="profile-nav shadowed">
        <nav class="navbar navbar-default cast-away-margin cast-away-border">
            <div class="container-fluid">
                <div class="navbar-header">
                    <a class="navbar-brand" href="#"><i class="icon-home"></i></a>
                </div>
                <div class="collapse navbar-collapse">
                    <ul class="nav navbar-nav">
                        <li class="active"><a href="#">文章 {{ user.posts.count() }}</a></li>
                        <li><a href="#">喜欢 {{ user.liked.count() }}</a></li>
                        <li><a href="#">收藏 0</a></li>
                    </ul>
                </div>
            </div>
        </nav>
    </div>
</div>


{#{% include '_posts.html' %}#}
{#<div class="pagination">#}
{#    {{ macros.pagination_widget(pagination, '.user')}}#}
{#    {{ macros.pagination_widget(pagination, '.user', username=username) }}#}
{#</div>#}
<div class="user-posts-card">{{ macros.posts_card(posts) }}</div>

{% endblock %}

{% block sidebar_content %}
    <div class="profile-sidebar-item text-muted" id="user-follows">
        <div class="following-item"><span>关注了</br><strong>{{ user.followed.count() - 1 }}</strong>人</span></div>
        <div class="following-item"><span>关注者</br><strong>{{ user.followers.count() - 1 }}</strong>人</span></div>
        <div class="clearfix"></div>
    </div>
    <div class="profile-sidebar-item text-muted" id="ping-time">
        <p>上次登陆 <strong>{{ moment(user.last_seen).fromNow() }}</strong></p>
        <p>加入时间 <strong>{{ moment(user.member_since).format('L') }}</strong></p>
    </div>
{% endblock %}